<!doctype html><html lang=zh-CN><meta charset=utf-8><title>追踪 V8 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="本文档说明了如何利用 V8 的内置追踪支持。" name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li class=active><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>追踪 V8</h1><p>V8 提供了对追踪（tracing）的支持。<a href=/docs/rcs>通过 Chrome 追踪系统将 V8 嵌入 Chrome 时，它会自动运行。</a>但是，你也可以在任何独立的 V8 或使用默认平台的嵌入程序中启用它。可以在<a href=https://github.com/catapult-project/catapult/blob/master/tracing/README.md>此处</a>找到有关追踪查看器（trace-viewer）的更多详细信息。<h2 id=tracing-in-d8>在 <code>d8</code> 中追踪 <a href=#tracing-in-d8 class=bookmark>#</a></h2><p>要开始跟踪，请使用 <code>--enable-tracing</code> 选项。V8 会生成一个 <code>v8_trace.json</code>，你可以在 Chrome 中打开它。要在Chrome中打开它，请转到 <code>chrome://tracing</code>，点击“加载”（Load），然后加载 <code>v8-trace.json</code> 文件。<p>每个追踪事件都与一组类别相关联，你可以根据其类别来启用/禁用追踪事件的记录。仅使用上述标志，我们仅启用默认类别（一组开销较低的类别）。要启用更多类别并更好地控制不同的参数，你需要传递一个配置文件。<p>这是一个配置文件 <code>traceconfig.json</code> 的示例：<pre class=language-json><code class=language-json><span class="token punctuation">{</span><br>  <span class="token property">"record_mode"</span><span class="token operator">:</span> <span class="token string">"record-continuously"</span><span class="token punctuation">,</span><br>  <span class="token property">"included_categories"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"v8"</span><span class="token punctuation">,</span> <span class="token string">"disabled-by-default-v8.runtime_stats"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>使用 traceconfig 文件追踪调用 <code>d8</code> 的示例：<br>An example of calling <code>d8</code> with tracing and a traceconfig file:<pre class=language-bash><code class=language-bash>d8 --enable-tracing --trace-config<span class="token operator">=</span>traceconfig.json</code></pre><p>追踪配置格式与 Chrome 追踪中的一种兼容，但是，我们不支持包含类别列表中的正则表达式，并且 V8 不需要排除类别列表，因此 V8 的追踪配置文件可以在 Chrome 追踪中重复使用 ，但是如果跟踪配置文件包含正则表达式，则无法在 V8 追踪中重用 Chrome 追踪配置文件，此外，V8 会忽略排除的类别列表。<h2 id=enabling-runtime-call-statistics-in-tracing>在追踪中启用运行时调用统计信息（Runtime Call Statistics） <a href=#enabling-runtime-call-statistics-in-tracing class=bookmark>#</a></h2><p>要获取运行时调用统计（<abbr>Runtime Call Statistics, RCS</abbr>），请在启用以下两个类别的情况下记录跟踪：<code>v8</code> 和 <code>disabled-by-default-v8.runtime_stats</code>。每个顶级 V8 追踪事件都包含该事件期间的运行时统计信息。通过在 <code>trace-viewer</code> 中选择这些事件中的任何一个，运行时状态表将显示在下部面板中。选择多个事件将创建一个合并视图。<figure><img alt="" height=1068 loading=lazy src=/_img/docs/trace/runtime-stats.png width=2048></figure><h2 id=enabling-gc-object-statistics-in-tracing>在追踪中启用 GC 对象统计信息（GC Object Statistics） <a href=#enabling-gc-object-statistics-in-tracing class=bookmark>#</a></h2><p>要在追踪中获取 GC 对象统计信息（GC Object Statistics），你需要收集启用了 <code>disabled-by-default-v8.gc_stats</code> 类别的追踪信息，还需要使用以下 <code>--js-flags</code>：<pre><code>--track_gc_object_stats --noincremental-marking
</code></pre><p>在 <code>trace-viewer</code> 中加载追踪信息后，搜索名为：<code>V8.GC_Object_Stats</code> 的片段。统计信息显示在下部面板中。选择多个片段将创建一个合并视图。<figure><img alt="" height=1162 loading=lazy src=/_img/docs/trace/gc-stats.png width=2586></figure><article><footer><div><p>译者：不如怀念 (<a href=https://github.com/wang1212>@wang1212</a>).</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/docs/trace>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/docs/trace.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>