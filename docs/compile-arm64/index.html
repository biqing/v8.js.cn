<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Compiling on Arm64 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="Tips and tricks to build V8 natively on Arm64" name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li class=active><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>Compiling on Arm64</h1><p>If you've gone through instructions on how to <a href=/docs/source-code>check out</a> and <a href=/docs/build-gn>build</a> V8 on a machine that is not x86, you may have ran into a bit of trouble, due to the build system downloading native binaries and then not being able to run them. However, even though using an Arm64 machine to work on V8 is <strong>not officially supported</strong>, overcoming those hurdles is pretty straightforward.<h2 id=bypassing-vpython>Bypassing <code>vpython</code> <a href=#bypassing-vpython class=bookmark>#</a></h2><p><code>fetch v8</code>, <code>gclient sync</code> and other <code>depot_tools</code> commands use a wrapper for python called "vpython". If you see errors related to it, you can define the following variable to use the system's python installation instead:<pre class=language-bash><code class=language-bash><span class="token builtin class-name">export</span> <span class="token assign-left variable">VPYTHON_BYPASS</span><span class="token operator">=</span><span class="token string">"manually managed python not supported by chrome operations"</span></code></pre><h2 id=building-ninja-and-gn-from-source>Building <code>ninja</code> and <code>gn</code> from source <a href=#building-ninja-and-gn-from-source class=bookmark>#</a></h2><p>The first thing to do is to make sure we have native binaries for <code>ninja</code> and <code>gn</code>, and that we pick those instead of the ones in <code>depot_tools</code>. A simple way to do this is to tweak your PATH as follows when installing <code>depot_tools</code>:<pre class=language-bash><code class=language-bash><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token constant environment">PATH</span></span><span class="token operator">=</span><span class="token constant environment">$PATH</span>:/path/to/depot_tools</code></pre><p>This way, you'll be able to use your system's <code>ninja</code> installation, given it's likely to be available. Although if it isn't you can <a href=https://github.com/ninja-build/ninja#building-ninja-itself>build it from source</a>.<p>Then you'll need <code>gn</code>, which can be built with:<pre class=language-bash><code class=language-bash><span class="token function">git</span> clone https://gn.googlesource.com/gn<br><span class="token builtin class-name">cd</span> gn<br>python build/gen.py<br>ninja -C out</code></pre><p>And finally tweak your <code>PATH</code> so that it comes before the <code>gn</code> from <code>depot_tools</code>.<pre class=language-bash><code class=language-bash><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token constant environment">PATH</span></span><span class="token operator">=</span>/path/to/gn/out:<span class="token constant environment">$PATH</span></code></pre><h2 id=compiling-clang>Compiling clang <a href=#compiling-clang class=bookmark>#</a></h2><p>By default, V8 will want to use its own build of clang that may not run on your machine. You could tweak GN arguments in order to <a href=#system_clang_gcc>use the system's clang or GCC</a>, however, you may want to use the same clang as upstream, as it will be the most supported version.<p>You can build it locally directly from the V8 checkout:<pre class=language-bash><code class=language-bash>./tools/clang/scripts/build.py --without-android --without-fuchsia <span class="token punctuation">\</span><br>                               --gcc-toolchain<span class="token operator">=</span>/usr --use-system-cmake <span class="token punctuation">\</span><br>                               --disable-asserts</code></pre><h2 id=setting-up-gn-arguments-manually>Setting up GN arguments manually <a href=#setting-up-gn-arguments-manually class=bookmark>#</a></h2><p>Convenience scripts may not work by default, instead you'll have to set GN arguments manually following the <a href=/docs/build-gn#gn>manual</a> workflow. You can get the usual "release", "optdebug" and "debug" configurations with the following arguments:<ul><li><code>release</code></ul><pre class=language-bash><code class=language-bash><span class="token assign-left variable">is_debug</span><span class="token operator">=</span>false</code></pre><ul><li><code>optdebug</code></ul><pre class=language-bash><code class=language-bash><span class="token assign-left variable">is_debug</span><span class="token operator">=</span>true<br><span class="token assign-left variable">v8_enable_backtrace</span><span class="token operator">=</span>true<br><span class="token assign-left variable">v8_enable_slow_dchecks</span><span class="token operator">=</span>true</code></pre><ul><li><code>debug</code></ul><pre class=language-bash><code class=language-bash><span class="token assign-left variable">is_debug</span><span class="token operator">=</span>true<br><span class="token assign-left variable">v8_enable_backtrace</span><span class="token operator">=</span>true<br><span class="token assign-left variable">v8_enable_slow_dchecks</span><span class="token operator">=</span>true<br><span class="token assign-left variable">v8_optimized_debug</span><span class="token operator">=</span>false</code></pre><h2 id=system_clang_gcc>Using the system's clang or GCC <a href=#system_clang_gcc class=bookmark>#</a></h2><p>Building with GCC is only a case of disabling compiling with clang:<pre class=language-bash><code class=language-bash><span class="token assign-left variable">is_clang</span><span class="token operator">=</span>false</code></pre><p>Note that by default, V8 will link using <code>lld</code>, which requires a recent version of GCC. You can use <code>use_lld=false</code> to switch to the gold linker, or additionally use <code>use_gold=false</code> to use <code>ld</code>.<p>If you'd like to use the clang that's installed with your system, say in <code>/usr</code>, you can use the following arguments:<pre class=language-bash><code class=language-bash><span class="token assign-left variable">clang_base_path</span><span class="token operator">=</span><span class="token string">"/usr"</span><br><span class="token assign-left variable">clang_use_chrome_plugins</span><span class="token operator">=</span>false</code></pre><p>However, given the system's clang version may not be well supported, you're likely to deal with warnings, such as unknown compiler flags. In this case it's useful to stop treating warnings as errors with:<pre class=language-bash><code class=language-bash><span class="token assign-left variable">treat_warnings_as_errors</span><span class="token operator">=</span>false</code></pre></main><footer id=footer><div><nav><a href=https://v8.dev/docs/compile-arm64>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/docs/compile-arm64.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>