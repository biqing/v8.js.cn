<!doctype html><html lang=zh-CN><meta charset=utf-8><title>WebAssembly Dynamic Tiering ready to try in Chrome 96 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="WebAssembly Dynamic Tiering ready to try in V8 v9.6 and Chrome 96, either through a commandline flag, or through an origin trial" name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>WebAssembly Dynamic Tiering ready to try in Chrome 96</h1><p class=meta>发布时间 <time datetime="2021-10-29 00:00:00" itemprop=datePublished title="2021-10-29 00:00:00">2021-10-29</time> · 标签： <a href=/blog/tags/webassembly/ class=tag>WebAssembly</a></header><div itemprop=articleBody><p>V8 has two compilers to compile WebAssembly code to machine code that can then be executed: the baseline compiler <strong>Liftoff</strong> and the optimizing compiler <strong>TurboFan</strong>. Liftoff can generate code much faster than TurboFan, which allows fast startup time. TurboFan, on the other hand, can generate faster code, which allows high peak performance.<p>In the current configuration of Chrome a WebAssembly module first gets compiled completely by Liftoff. After Liftoff compilation is finished, the whole module gets compiled again immediately in the background by TurboFan. With streaming compilation, TurboFan compilation can start earlier if Liftoff compiles WebAssembly code faster than the WebAssembly code is downloaded. The initial Liftoff compilation allows fast startup time, whereas the TurboFan compilation in the background provides high peak performance as soon as possible. More details about Liftoff, TurboFan, and the whole compilation process can be found in a <a href=https://v8.dev/docs/wasm-compilation-pipeline>separate document</a>.<p>Compiling the whole WebAssembly module with TurboFan provides the best possible performance once compilation is completed, but that comes at a cost:<ul><li>The CPU cores that execute TurboFan compilation in the background can block other tasks that would require the CPU, e.g. workers of the web application.<li>TurboFan compilation of unimportant functions may delay the TurboFan compilation of more important functions, which may delay the web application to reach full performance.<li>Some WebAssembly functions may never get executed, and spending resources on compiling these functions with TurboFan may not be worth it.</ul><h2 id=dynamic-tiering>Dynamic tiering <a href=#dynamic-tiering class=bookmark>#</a></h2><p>Dynamic tiering should alleviate these issues by compiling only those functions with TurboFan that actually get executed multiple times. Thereby dynamic tiering can change the performance of web applications in several ways: dynamic tiering can speed up startup time by reducing the load on CPUs and thereby allowing startup tasks other than WebAssembly compilation to use the CPU more. Dynamic tiering can also slow down performance by delaying TurboFan compilation for important functions. As V8 does not use on-stack-replacement for WebAssembly code, the execution can be stuck in a loop in Liftoff code, for example. Also code caching is affected, because Chrome only caches TurboFan code, and all functions that never qualify for TurboFan compilation get compiled with Liftoff at startup even when the compiled WebAssembly module already exists in cache.<h2 id=how-to-try-it-out>How to try it out <a href=#how-to-try-it-out class=bookmark>#</a></h2><p>We encourage interested developers to experiment with the performance impact of dynamic tiering on their web applications. This will allow us to react and avoid potential performance regressions early. Dynamic tiering can be enabled locally by running Chrome with the command line flag <code>--enable-blink-features=WebAssemblyDynamicTiering</code>.<p>V8 embedders who want to enable dynamic tiering can do so by setting the V8 flag <code>--wasm-dynamic-tiering</code>.<h3 id=testing-in-the-field-with-an-origin-trial>Testing in the field with an Origin Trial <a href=#testing-in-the-field-with-an-origin-trial class=bookmark>#</a></h3><p>Running Chrome with a command line flag is something a developer can do, but it should not be expected from an end user. To experiment with your application in the field, it is possible to join what is called an <a href=https://github.com/GoogleChrome/OriginTrials/blob/gh-pages/developer-guide.md>Origin Trial</a>. Origin trials allow you to try out experimental features with end users through a special token that is tied to a domain. This special token enables WebAssembly dynamic tiering for the end user on specific pages that include the token. To obtain your own token to run an origin trial, <a href=https://developer.chrome.com/origintrials/#/view_trial/3716595592487501825>use the application form</a>.<h2 id=give-us-feedback>Give us feedback <a href=#give-us-feedback class=bookmark>#</a></h2><p>We're looking for feedback from developers trying out this feature as it'll help to get the heuristics right on when TurboFan compilation is useful, and when TurboFan compilation does not pay off and can be avoided. The best way to send feedback is to <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1260322">report issues</a>.</div><footer><div><picture><source srcset="/_img/avatars/andreas-haas.avif, /_img/avatars/andreas-haas@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/andreas-haas.jpg srcset="/_img/avatars/andreas-haas@2x.jpg 2x" width=96></picture><p>作者：Andreas Haas — Tierisch fun.</div><a href=https://twitter.com/v8js/status/1454158971674271760 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/wasm-dynamic-tiering>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/wasm-dynamic-tiering.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>