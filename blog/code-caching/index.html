<!doctype html><html lang=zh-CN><meta charset=utf-8><title>代码缓存 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="V8 现在支持（字节）代码缓存，即缓存 JavaScript 解析+编译的结果。" name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>代码缓存</h1><p class=meta>发布时间 <time datetime="2015-07-27 13:33:37" itemprop=datePublished title="2015-07-27 13:33:37">2015-07-27</time> · 标签： <a href=/blog/tags/internals/ class=tag>internals</a></header><div itemprop=articleBody><p>V8 使用<a href=https://en.wikipedia.org/wiki/Just-in-time_compilation>即时编译</a>（JIT）来执行 JavaScript 代码。这意味着在运行脚本之前，必须先对其进行解析和编译，这可能会导致相当大的开销。正如我们<a href=https://blog.chromium.org/2015/03/new-javascript-techniques-for-rapid.html>最近宣布</a>的那样，代码缓存（code caching）是一种减少这种开销的技术。首次编译脚本时，将生成并存储缓存数据。下次 V8 需要编译相同的脚本时，即使在不同的 V8 实例中，它也可以使用缓存数据来重新创建编译结果，而不是从头开始编译。结果，脚本执行得更快。<p>从 V8 4.2 版开始，就可以使用代码缓存，而不仅限于 Chrome。它通过 V8 的 API 公开，因此每个 V8 嵌入程序都可以利用它。用于测试此功能的<a href=https://chromium.googlesource.com/v8/v8.git/+/4.5.56/test/cctest/test-api.cc#21090>测试用例</a>用作如何使用此 API 的示例。<p>当 V8 编译脚本时，可以通过传递 <code>v8::ScriptCompiler::kProduceCodeCache</code> 作为选项来生成缓存数据，以加快以后的编译速度。如果编译成功，则缓存数据将附加到源对象，并且可以通过 <code>v8::ScriptCompiler::Source::GetCachedData</code> 进行检索。然后可以将其持久化，以备以后使用，例如，将其写入磁盘。<p>在以后的编译期间，可以将先前生成的缓存数据附加到源对象，并作为选项传递 <code>v8::ScriptCompiler::kConsumeCodeCache</code>。这次，由于 V8 绕过了编译代码并从提供的缓存数据中反序列化代码，因此代码的生成速度将大大提高。<p>生产缓存数据需要一定的计算和内存成本。因此，Chrome 仅在两天内至少两次看到相同脚本时才会生成缓存数据。通过这种方式，Chrome 可以平均将脚本文件转换为可执行代码的速度提高两倍，从而节省了用户在每次后续页面加载时的宝贵时间。</div><footer><div><picture><source srcset="/_img/avatars/yang-guo.avif, /_img/avatars/yang-guo@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/yang-guo.jpg srcset="/_img/avatars/yang-guo@2x.jpg 2x" width=96></picture><p>作者：Yang Guo (<a href=https://twitter.com/hashseed>@hashseed</a>), Software Engineer.</div></footer><footer><div><p>译者：不如怀念 (<a href=https://github.com/wang1212>@wang1212</a>).</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/code-caching>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/code-caching.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>