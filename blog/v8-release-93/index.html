<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v9.3 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="V8 release v9.3 brings support for Object.hasOwn and Error causes, improves compilation performance and disables untrusted codegen mitigations on Android." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v9.3</h1><p class=meta>发布时间 <time datetime="2021-08-09 00:00:00" itemprop=datePublished title="2021-08-09 00:00:00">2021-08-09</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=https://v8.dev/docs/release-process>release process</a>. Each version is branched from V8’s main Git branch immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/9.3>V8 version 9.3</a>, which is in beta until its release in coordination with Chrome 93 Stable in several weeks. V8 v9.3 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=javascript>JavaScript <a href=#javascript class=bookmark>#</a></h2><h3 id=sparkplug-batch-compilation>Sparkplug batch compilation <a href=#sparkplug-batch-compilation class=bookmark>#</a></h3><p>We released our super-fast new mid-tier JIT compiler <a href=https://v8.dev/blog/sparkplug>Sparkplug</a> in v9.1. For security reasons V8 <a href=https://en.wikipedia.org/wiki/W%5EX>write-protects</a> code memory that it generates, requiring it to flip permissions between writable (during compilation) and executable. This is currently implemented using <code>mprotect</code> calls. However, since Sparkplug generates code so quickly, the cost of calling <code>mprotect</code> for each individual compiled function became a major bottleneck in the compilation time. In V8 v9.3 we’re introducing batch compilation for Sparkplug: Instead of compiling each function individually, we compile multiple functions in a batch. This amortises the cost of flipping memory page permissions by doing it only once per batch.<p>Batch compilation reduces overall compilation time (Ignition + Sparkplug) by up to 44% without regressing JavaScript execution. If we only look at the cost of compiling Sparkplug code the impact is obviously larger, e.g. a reduction of 82% for the <code>docs_scrolling</code> benchmark (see below) on Win 10. Surprisingly enough, batch compilation improved compilation performance by even more than the cost of W^X, since batching similar operations together tends to be better for the CPU anyway. In the chart below you can see the impact of W^X on compile time (Ignition + Sparkplug), and how well batch compilation mitigated that overhead.<figure><img alt="" height=395 loading=lazy src=/_img/v8-release-93/sparkplug.svg width=638><figcaption>Benchmarks</figcaption></figure><h3 id=object.hasown><code>Object.hasOwn</code> <a href=#object.hasown class=bookmark>#</a></h3><p><code>Object.hasOwn</code> is an easier-to-reach-for alias for <code>Object.prototype.hasOwnProperty.call</code>.<p>For example:<pre class=language-javascript><code class=language-javascript>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'prop'</span><span class="token punctuation">)</span><br><span class="token comment">// → true</span></code></pre><p>Slightly more (but not much more!) details are available in our <a href=https://v8.dev/features/object-has-own>feature explainer</a>.<h3 id=error-cause>Error cause <a href=#error-cause class=bookmark>#</a></h3><p>Starting in v9.3, the various built-in <code>Error</code> constructors are extended to accept an options bag with a <code>cause</code> property for the second parameter. If such an options bag is passed, the value of the <code>cause</code> property is installed as an own property on the <code>Error</code> instance. This provides a standardized way to chain errors.<p>For example:<pre class=language-javascript><code class=language-javascript><span class="token keyword">const</span> parentError <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'parent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'parent'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">cause</span><span class="token operator">:</span> parentError <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>cause <span class="token operator">===</span> parentError<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → true</span></code></pre><p>As usual, please see our more in-depth <a href=https://v8.dev/features/error-cause>feature explainer</a>.<h2 id=untrusted-code-mitigations-disabled-on-android>Untrusted code mitigations disabled on Android <a href=#untrusted-code-mitigations-disabled-on-android class=bookmark>#</a></h2><p>Three years ago we introduced a set of <a href=https://v8.dev/blog/spectre>code generation mitigations</a> to defend against Spectre attacks. We always realized that this was a temporary stop-gap that only provided partial protection against <a href=https://spectreattack.com/spectre.pdf>Spectre</a> attacks. The only effective protection is to isolate websites via <a href=https://blog.chromium.org/2021/03/mitigating-side-channel-attacks.html>Site Isolation</a>. Site Isolation has been enabled on Chrome on desktop devices for some time, however enabling full Site Isolation on Android has been more of a challenge due to resource constraints. However, as of Chrome 92, <a href=https://security.googleblog.com/2021/07/protecting-more-with-site-isolation.html>Site Isolation on Android</a> has been enabled on many more sites that contain sensitive data.<p>Thus, we have decided to disable V8’s code generation mitigations for Spectre on Android. These mitigations are less effective than Site Isolation and impose a performance cost. Disabling them brings Android on par with desktop platforms, where they have been turned off since V8 v7.0. By disabling these mitigations we have seen some significant improvements in benchmark performance on Android.<figure><img alt="" height=371 loading=lazy src=/_img/v8-release-93/code-mitigations.svg width=600><figcaption>Performance improvements</figcaption></figure><h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>Please use <code>git log branch-heads/9.2..branch-heads/9.3 include/v8.h</code> to get a list of the API changes.<p>Developers with an active V8 checkout can use <code>git checkout -b 9.3 -t branch-heads/9.3</code> to experiment with the new features in V8 v9.3. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><picture><source srcset="/_img/avatars/ingvar-stepanyan.avif, /_img/avatars/ingvar-stepanyan@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/ingvar-stepanyan.jpg width=96 srcset="/_img/avatars/ingvar-stepanyan@2x.jpg 2x"></picture><p>作者：Ingvar Stepanyan (<a href=https://twitter.com/RReverser>@RReverser</a>).</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-93>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-93.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>